

# New guide zk snark project 3

--- 

## üì¶ PHASE 1 ‚Äî CIRCUIT ‚Üí PROOF

## üì¶ 1 Compile circuit
Install Circomlib:
```bash 
npm install circomlib
```
Compile circuit command: 
```bash 
circom password.circom --r1cs --wasm
```
Output:
```bash 
password.r1cs       ‚Üíconstraintsystem
password_js/        ‚Üí wasm + witness generator
```
Kalau error run:
```bash
circom password.circom --r1cs --wasm -l node_modules
```

Makna: 

| file | fungsi                          |
|:----|:--------------------------------|
| .r1cs   | representasi matematika circuit |
| .wasm   | engine pembuat witness          |
| generate_witness.js | helper buat witness             |

---

## 2 Setup trusted setup (Powers of Tau)
Create ceremony file
```bash 
snarkjs powersoftau new bn128 12 pot12_0000.ptau
```
Makna:
- bn128 ‚Üí curve Groth16
- 12 ‚Üí size circuit (~2^12 constraints) 

Note:  
If you want multiple contributors, create intermediate ptau files 
(e.g. pot12_0001.ptau, pot12_0002.ptau). 
For single-user setup, directly generating pot12_final.ptau is sufficient.  

Contribute entropy
```bash 
snarkjs powersoftau contribute pot12_0000.ptau pot12_final.ptau
```
fungsi: 
- mengamankan toxic waste
- membuat parameter publik final  

prepare phase2:
```bash
snarkjs powersoftau prepare phase2 pot12_final.ptau pot12_phase2.ptau
```
--- 

## 3 Circuit-specific setup (Groth16)
```bash 
snarkjs groth16 setup password.r1cs pot12_phase2.ptau password.zkey
```
Output:
```bash 
password.zkey
```
ini file paling penting -> Berisi proving key + verifying key

---

## 4 Export verification key
```bash 
snarkjs zkey export verificationkey password.zkey verification_key.json
```
Dipakai untuk:
- generate Solidity verifier
- offchain verify

---

## 5 Generate Solidity verifier
```bash 
snarkjs zkey export solidityverifier password.zkey Verifier.sol
```
Output:
```bash
 Verifier.sol
 ```
ini yang akan dipakai dicopy ke hardhat

---

# INPUT & WITNESS

---

## 6Ô∏è Generate input.json (commitment)
install dependency:
```bash
npm install circomlibjs ffjavascript
```
dari: 
```bash
node genInput.js
```
Output:
```bash
input.json
Commitment: XXXXX
```
isinya:
```bash 
password
salt
commitment
```
ini harus konsisten dengan circuit

--- 

## 7 Generate witness
Masuk folder wasm:
```bash
cd password_js
```
Run:
```bash
node generate_witness.js password.wasm ../input.json ../witness.wtns
```
Output:
```bash
witness.wtns
```
Makna:
- witness = semua nilai intermediate circuit

---
## 8 Generate proof
Blik ke root
```bash
cd ..
```
Run:
```bash
snarkjs groth16 prove password.zkey witness.wtns proof.json public.json
```
Output:
```bash 
proof.json
public.json
```

--- 

## 9 Verify locally
```bash
snarkjs groth16 verify verification_key.json public.json proof.json
```
Output:
```bash
OK
```
Artinya:
- ZK proof kamu VALID secara kriptografi.

--- 

# PHASE 2 - BLOCKCHAIN

---

Folder:
```bash 
password verification/blockchain
```

## 10 Init Hardhat
```bash
npx hardhat --init
hardhat.config.ts
contracts/
scripts/
``` 

---

## 11 Copy Verifier.sol
Taruh ke:
```bash
blockchain/contracts/Verifier.sol
```

---

## 12 Compile Smartcontrack
```bash
npx hardhat compile
```
Jika sukses:
```bash
artifacts/
cache/
```
berhasil dibuat

---

## 13 Deploy ke Sepolia
Script:
```bash
scripts/deploy.ts
```
Run:
```bash
npx hardhat run scripts/deploy.ts --network sepolia
```
Output:
```bash
Contract deployedto:
0x....
```
hasil: 
```bash
Verifier deployed to: 0x85eaD55c474D3C525A37b694225D07a85bBDA9f7
```
Ini alamat verifier.  
The verifier contract is a standard Solidity smart contract generated by snarkjs, whose sole purpose is to verify zero-knowledge proofs on-chain without revealing any private inputs.

---
# ON-CHAIN VERIFY
---

## 14 Masuk Hardhat Console
```bash 
npx hardhat console --network sepolia
```

---

## 15 Load Contrack
Di console:
```c
const { ethers } =await import("ethers")
const provider =new ethers.JsonRpcProvider(process.env.RPC_URL)
const wallet =new ethers.Wallet(process.env.PRIVATE_KEY, provider)
const artifact =await hre.artifacts.readArtifact("Groth16Verifier")

const contract =new ethers.Contract(
"0x85eaD55c474D3C525A37b694225D07a85bBDA9f7",
 artifact.abi,
 wallet
)
```

---

## 16 Call verifyProof
Generate solidity call data dari root project:
```bash
snarkjs zkey export soliditycalldata public.json proof.json
```

Dari proof.json kamu copy:
```bash
await contract.verifyProof(a,b,c,input)
```
isi a,b,c dan input:
```bash
await contract.verifyProof(["0x151b464a976ef815da6f52aca6e8c532e6da26c9045fc9ee5a8167671ae50a4b", "0x2059266664471a87f3225452092535834b436c8675bc4dfe6a610b97ef1ff7a3"],[["0x1ab193281d365c9e75f506353313401cad112d0e9eaf16b7d4f14f206adc7e62", "0x0eddfdb80240d30a9597f756f414c2c18920916f53b88cca33ae010d535ab00c"],["0x1cbdc8575a48f99ff0b410a7cce04ef31dbbd4071ee10e2efd40770c7ed1eb06", "0x1cc12b3324f671811065b62529bff68a9faeb2c49d710bc36276444a62b20229"]],["0x21b6ed67233f0c8fd3cbf0ce0a74b18ff20cfc25c6408870040b802680f75aed", "0x291a874e1ef75a12ccbd2bd9dcb53706184ed74336a830e4653c77e688b0bd66"],["0x22634a86be9ecaee4724fccbae623c9fe60454f65f459b42029af1f823463b07"])
```
Output:
```bash
true
```
ini berati:
- Proof berhasil diverifikasi ON-CHAIN. 


Flow:
``` bash
password.circom
     ‚Üì
.r1cs + wasm
     ‚Üì
input.json
     ‚Üì
witness
     ‚Üì
proof.json
     ‚Üì
Verifier.sol
     ‚Üì
Hardhat Deploy
     ‚Üì
verifyProof ON-CHAIN
```